<!-- Copyright (C) 2025 Yueming (mkyuu), All rights reserved-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Web IDE</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f5f5f5; }
        #editor, #console { width: 100%; height: 200px; padding: 10px; font-family: monospace; background: white; border: 1px solid #ddd; }
        #console { background: black; color: white; overflow-y: auto; padding: 10px; }
        .error { color: red; }
        .var-list { background: white; padding: 10px; border: 1px solid #ddd; margin-top: 10px; }
    </style>
</head>
<body>
    <h2>Python Web IDE</h2>
    <textarea id="editor">print("Hello, World!")</textarea>
    <button onclick="runCode()">Run</button>
    <h3>Console Output:</h3>
    <pre id="console"></pre>
    <h3>Variables:</h3>
    <div id="variables" class="var-list"></div>

    <script>
        let pyodideInstance = null;

        async function initializePyodide() {
            console.log("Loading Pyodide...");
            pyodideInstance = await loadPyodide();
            console.log("Pyodide loaded.");
            pyodideInstance.runPython(`
                import sys
                from io import StringIO
                sys.stdout = StringIO()
                sys.stderr = sys.stdout
            `);
        }

        async function runCode() {
            if (!pyodideInstance) {
                document.getElementById("console").textContent = "Loading Pyodide... Please wait.";
                await initializePyodide();
            }

            let consoleElement = document.getElementById("console");
            let varElement = document.getElementById("variables");
            let code = document.getElementById("editor").value;

            consoleElement.textContent = "Running...\n";

            try {
                pyodideInstance.runPython(code);
                let output = pyodideInstance.runPython("sys.stdout.getvalue()");
                consoleElement.textContent = output;

                let vars = pyodideInstance.runPython("locals()");
                varElement.innerHTML = Object.keys(vars).map(v => `<b>${v}</b>: ${vars[v]}`).join("<br>");
            } catch (error) {
                consoleElement.innerHTML = `<span class='error'>${error}</span>`;
            }
        }

        // Preload Pyodide as soon as the page loads
        initializePyodide();
    </script>
</body>
</html>
